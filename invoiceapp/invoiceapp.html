<!DOCTYPE html>
<html>
<head>
  <title>Invoices</title>
  <script src="/sys/webcomponentsjs/webcomponents.js"></script><!-- load Web Components polyfill for all browsers -->
  <link rel="import" href="/sys/starcounter.html"><!-- import Web Components needed for client-server sync -->
  <link rel="stylesheet" href="/style.css"><!-- load stylesheet -->
  <link rel="import" href="/sys/puppet-redirect/src/puppet-redirect.html">
</head>

<body>
<template id="root" bind><!-- create document template, which is to be bound to the JSON view-model -->

  <section><!-- start left pane of the UI -->
    <h3>Invoices</h3>

    <table class="invoiceTable">
      <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Total</th>
      </tr>
      </thead>

      <tbody>
      <template repeat="{{ invoice in Invoices }}"><!-- iterate over Invoices array elements to render the list of invoices -->
        <tr>
          <td><a href="/invoice/{{invoice.InvoiceNo}}">{{invoice.InvoiceNo}}</a></td>
          <td class="readonlycell">{{invoice.Name}}</td>
          <td class="readonlycell alignright">{{invoice.Total}}</td>
        </tr>
      </template>
      </tbody>

      <caption>
        <button onclick="getModel(this).Add$++">Add invoice</button><!-- trigger Add$ handler -->
      </caption>

    </table>
  </section><!-- end left pane of the UI -->

  <section class="invoice"><!-- start right pane of the UI -->

    <template if="{{Invoice.InvoiceNo}}"><!-- display Invoice.InvoiceNo, if provided -->
      <h3>Invoice #{{Invoice.InvoiceNo}}</h3>
    </template>

    <template if="{{!Invoice.InvoiceNo}}"><!-- if Invoice.InvoiceNo not provided, display new invoice heading -->
      <h3>Add new invoice</h3>
    </template>

    <div class="invoiceSubtitle">
      <label>Name</label>
      <input type="text" value="{{Invoice.Name$}}"/><!-- display Name$ and bind it for editing -->
    </div>

    <table class="invoiceTable">

      <thead>
      <tr>
        <th>Description</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Total</th>
      </tr>
      </thead>

      <tbody>
      <template repeat="{{ item in Invoice.Items }}"><!-- iterate over Invoice.Items array elements to render the invoice rows -->
        <tr>
          <td><input type="text" value="{{item.Description$}}"/></td><!-- display Description$ and bind it for editing -->
          <td><input update-on="input" type="number" value="{{item.Quantity$}}"/></td><!-- display Quantity$ and bind it for editing -->
          <td><input update-on="input" type="number" value="{{item.Price$}}"/></td><!-- display Price$ and bind it for editing -->
          <td class="readonlycell alignright">{{item.Total}}</td><!-- display Total -->
        </tr>
      </template>
      </tbody>

      <tfoot>
      <tr>
        <td colspan="3"></td>
        <td class="total">{{Invoice.Total}}</td>
      </tr>
      </tfoot>

      <caption>
        <button onclick="getModel(this).Invoice.AddRow$++">Add row</button><!-- trigger AddRow$ handler -->
        <button onclick="getModel(this).Invoice.Save$++">Save changes</button><!-- trigger Save$ handler -->
        <button onclick="getModel(this).Invoice.Cancel$++">Cancel changes</button><!-- trigger Cancel$ handler -->
        <button onclick="getModel(this).Invoice.Delete$++">Delete invoice</button><!-- trigger Delete$ handler -->
      </caption>

    </table>

  </section><!-- end right pane of the UI -->
  <link is="puppet-redirect" history url="{{RedirectUrl$}}">
</template>

<puppet-js ref="root" useWebSocket></puppet-js><!-- plug in client-server sync -->
</body>
</html>
